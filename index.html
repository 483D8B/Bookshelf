<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <title>My Bookshelf</title>
  <style>
    /* CSS Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
	      scrollbar-color: #483d8b aliceblue;
    scrollbar-width: thin;
    caret-color: black;
    cursor: url("data:image/x-icon;base64,AAACAAEAICAAAAAAAACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAgBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP+AAID/cQBx/x4AHvUAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/3EAcf8eAB71AAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/HgAe9QAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABcAF9oAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA///////////////////////////////////////////////////////////////////////////////////////////7////MP///wD///8A////Af///wA///8AP///AH///wD///8B////A////wf///8P////H////z////8="), default;
    }
	
	::-webkit-scrollbar{
	display:none;
	}

    body {
	overflow-x:hidden;
    }

    :root {
      --spine-pyramid: linear-gradient(
      315deg,
      transparent 75%,
      rgba(255, 255, 255, 0.1) 0
      ),
      linear-gradient(
        45deg,
         transparent 75%,
          rgba(255, 255, 255, 0.1) 0
      ),
      linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.2) 166px,
        transparent 0
      ),
      linear-gradient(
        45deg,
        rgba(0, 0, 0, 0.1) 75%,
        transparent 0
      );
      background-size: 20px 20px;
    --spine-stairs: repeating-linear-gradient(
        63deg,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.1) 1px,
        transparent 3px,
        transparent 0
      ),
      linear-gradient(
        127deg,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.1) 90px,
        transparent 55%,
        transparent 0
      ),
      linear-gradient(
        transparent 51%,
        rgba(0, 0, 0, 0.1) 170px
      );
      background-size: 70px 120px;
    --spine-argyle: repeating-linear-gradient(
        120deg,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.1) 1px,
        transparent 1px,
        transparent 60px
      ),
      repeating-linear-gradient(
        60deg,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.1) 1px,
        transparent 1px,
        transparent 60px
      ),
      linear-gradient(
        60deg,
        rgba(0, 0, 0, 0.1) 25%,
        transparent 25%,
        transparent 75%,
        rgba(0, 0, 0, 0.1) 75%,
        rgba(0, 0, 0, 0.1)
      ),
      linear-gradient(
        120deg,
        rgba(0, 0, 0, 0.1) 25%,
        transparent 25%,
        transparent 75%,
        rgba(0, 0, 0, 0.1) 75%,
        rgba(0, 0, 0, 0.1)
      );
    background-size: 70px 120px;
    --spine-tartan: repeating-linear-gradient(
        transparent,
        transparent 50px,
        rgba(0, 0, 0, 0.1) 50px,
        rgba(0, 0, 0, 0.1) 53px,
        transparent 53px,
        transparent 63px,
        rgba(0, 0, 0, 0.1) 63px,
        rgba(0, 0, 0, 0.1) 66px,
        transparent 66px,
        transparent 116px,
        rgba(0, 0, 0, 0.1) 116px,
        rgba(0, 0, 0, 0.1) 166px,
        rgba(255, 255, 255, 0.1) 166px,
        rgba(255, 255, 255, 0.1) 169px,
        rgba(0, 0, 0, 0.1) 169px,
        rgba(0, 0, 0, 0.1) 179px,
        rgba(255, 255, 255, 0.1) 179px,
        rgba(255, 255, 255, 0.1) 182px,
        rgba(0, 0, 0, 0.1) 182px,
        rgba(0, 0, 0, 0.1) 232px,
        transparent 232px
      ),
      repeating-linear-gradient(
        270deg,
        transparent,
        transparent 50px,
        rgba(0, 0, 0, 0.4) 50px,
        rgba(0, 0, 0, 0.4) 53px,
        transparent 53px,
        transparent 63px,
        rgba(0, 0, 0, 0.4) 63px,
        rgba(0, 0, 0, 0.4) 66px,
        transparent 66px,
        transparent 116px,
        rgba(0, 0, 0, 0.5) 116px,
        rgba(0, 0, 0, 0.5) 166px,
        rgba(255, 255, 255, 0.2) 166px,
        rgba(255, 255, 255, 0.2) 169px,
        rgba(0, 0, 0, 0.5) 169px,
        rgba(0, 0, 0, 0.5) 179px,
        rgba(255, 255, 255, 0.2) 179px,
        rgba(255, 255, 255, 0.2) 182px,
        rgba(0, 0, 0, 0.5) 182px,
        rgba(0, 0, 0, 0.5) 232px,
        transparent 232px
      ),
      repeating-linear-gradient(
        125deg,
        transparent,
        transparent 2px,
        rgba(0, 0, 0, 0.2) 2px,
        rgba(0, 0, 0, 0.2) 3px,
        transparent 3px,
        transparent 5px,
        rgba(0, 0, 0, 0.2) 5px
      );
    }
	
	  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #1b1a23;
    /*display: block; */
	z-index:90;
  }


    #container,
    #container2,
    #container3 {
      display: flex;
      flex-wrap: wrap;
      border: solid 10px black;
      background-image: url('bamboo.webp');
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 5px;
      border-image: url("woodBorder.webp") 30 30 stretch;
      border: 15px solid url("woodBorder.webp") 30 30 stretch;
      box-shadow: inset 0px 12px 25px 5px rgba(0, 0, 0, 0.7);
      border-top: 30px solid;
    }


    .book {
    width: 50px;
    height: 250px;
    position: relative;
    margin-left: 1px;
    transform-style: preserve-3d;
    transform: translateZ(0) rotateY(0);
    transition: transform 1s;
    background-image: var(--spine-tartan);
    border-radius: 10px;
  }
  
  .side {
    position: absolute;
    border: 2px solid black;
    border-radius: 3px;
    font-weight: bold;
    color: black;
    text-align: center;
    transform-origin: center left;
    border-radius: 5px;
  }
  
  .spine {
    position: relative;
    width: 50px;
    height: 250px;
    /* Patterns from: https://projects.verou.me/css3patterns/ */
    transform: rotateY(0deg) translateZ(0px);
  }
  
  .spine-title {
    margin: 2px;
    position: absolute;
    top: 0px;
    right: 0px;
    font-size: 0.9em;
    color:black;
    writing-mode: vertical-rl;
    text-orientation: mixed;
  }
  
  .spine-author {
    position: absolute;
    color: black;
    background-color: hsla(0, 0%, 100%, 0.7);
    bottom: 0px;
    padding: 2px;
    border-radius: 3px;
    left: 0; /* no idea why 20% centers it */
    writing-mode: vertical-rl;
    font-size: 0.5em;
  }
  
  .top {
    width: 50px;
    height: 190px;
    top: 0px;  /* hmm, why -2 and not 0? */
    background-image: linear-gradient(90deg, white 90%, gray 10%);
    background-size: 5px 5px;
    transform: rotateX(90deg) translateZ(95px) translateY(-95px);
  }
  
  .cover {
    width: 190px;
    height: 250px;
    top: 0px;
    background-image: url("https://picsum.photos/190/280");
    background-size: contain;
    background-repeat: round;
    left: 50px;
    transform: rotateY(90deg) translateZ(0);
    transition: transform 1s;
  }
  
  .book:hover {
    transform: rotateX(-25deg) rotateY(-40deg) rotateZ(-15deg) translateY(50px)
      translateX(-30px);
	  z-index:10;
  }

    .inner {
      position: absolute;
      top: 50%;
      left: 40%;
      margin: 10px;
      width: 250px;
      font-size: 1em;
      color: white;
      font-weight: 600;
      text-align: center;
    }

    h2{
      position: absolute;
      color: white;
      font-family: Verdana, Geneva, Tahoma, sans-serif;
      padding-left: 10px;
      text-shadow: -1px -1px 1px #fff, 1px 1px 1px #000;
      opacity: 0.3;
      text-align: center;
      letter-spacing: 5px;
      text-shadow: 0 0 10px black, 0 0 20px black, 0 0 30px black;
      color: #fff;
      width: 98vw;%
    }

  
    .rotate {
      transform: translateX(-50%) translateY(-50%) rotate(90deg);
    }
	
	

  .power-switch {
	 --color-invert: #fff;
	 position: absolute;
	 top:0;
	 right:0;
	 margin-top:1em;
	 margin-right:1em;
	 display: flex;
	 justify-content: center;
	 align-items: center;
	 width: 50px;
	 height: 50px;
	 border-radius:50%;
	 background: #1b1a23;
}
 .power-switch .button {
	 width: 100%;
	 height: 100%;
	 display: flex;
	 justify-content: center;
	 align-items: center;
	 position: relative;
}
 .power-switch .button:after {
	 content: "";
	 width: 100%;
	 height: 100%;
	 position: absolute;
	 background: radial-gradient(circle closest-side, var(--color-invert), transparent);
	 filter: blur(1px);
	 opacity: 0;
	 transition: opacity 1s ease, transform 1s ease;
	 transform: perspective(1px) translateZ(0);
	 backface-visibility: hidden;
}
 .power-switch .button .power-on, .power-switch .button .power-off {
	 height: 100%;
	 width: 100%;
	 position: absolute;
	 z-index: 91;
	 fill: none;
	 stroke: var(--color-invert);
	 stroke-width: 8px;
	 stroke-linecap: round;
	 stroke-linejoin: round;
}
 .power-switch .button .power-on .line, .power-switch .button .power-off .line {
	 opacity: 0.2;
}
 .power-switch .button .power-on .circle, .power-switch .button .power-off .circle {
	 opacity: 0.2;
	 transform: rotate(-58deg);
	 transform-origin: center 26.66px;
	 stroke-dasharray: 220;
	 stroke-dashoffset: 40;
}
 .power-switch .button .power-on {
	 filter: drop-shadow(0px 0px 6px rgba(255, 255, 255, .8));
}
 .power-switch .button .power-on .line {
	 opacity: 0;
	 transition: opacity 0.3s ease 0.4s;
}
 .power-switch .button .power-on .circle {
	 opacity: 1;
	 stroke-dashoffset: 220;
	 transition: transform 0s ease, stroke-dashoffset 0.4s ease 0s;
}
 .power-switch input {
	 position: absolute;
	 height: 100%;
	 width: 100%;
	 z-index: 92;
	 cursor: pointer;
	 opacity: 0;
}
 .power-switch input:checked + .button:after {
	 opacity: 0.8;
	 transform: scale(2) perspective(1px) translateZ(0);
	 backface-visibility: hidden;
	 transition: opacity 0.5s ease, transform 0.5s ease;
}
 .power-switch input:checked + .button .power-on, .power-switch input:checked + .button .power-off {
	 animation: click-animation 0.3s ease forwards;
	 transform: scale(1);
}
 .power-switch input:checked + .button .power-on .line, .power-switch input:checked + .button .power-off .line {
	 animation: line-animation 0.8s ease-in forwards;
}
 .power-switch input:checked + .button .power-on .circle, .power-switch input:checked + .button .power-off .circle {
	 transform: rotate(302deg);
}
 .power-switch input:checked + .button .power-on .line {
	 opacity: 1;
	 transition: opacity 0.05s ease-in 0.55s;
}
 .power-switch input:checked + .button .power-on .circle {
	 transform: rotate(302deg);
	 stroke-dashoffset: 40;
	 transition: transform 0.4s ease 0.2s, stroke-dashoffset 0.4s ease 0.2s;
}
 @keyframes line-animation {
	 0% {
		 transform: translateY(0);
	}
	 10% {
		 transform: translateY(3.33px);
	}
	 40% {
		 transform: translateY(-8.33px);
	}
	 60% {
		 transform: translateY(-8.33px);
	}
	 85% {
		 transform: translateY(3.33px);
	}
	 100% {
		 transform: translateY(0px);
	}
}
 @keyframes click-animation {
	 0% {
		 transform: scale(1);
	}
	 50% {
		 transform: scale(0.9);
	}
	 100% {
		 transform: scale(1);
	}
}


  </style>
</head>

<body>
  <!-- Your content here -->
  <div class="overlay"></div>
  
  
  <div class="power-switch">
  <input type="checkbox" />
  <div class="button">
    <svg class="power-off">
      <use xlink:href="#line" class="line" />
      <use xlink:href="#circle" class="circle" />
    </svg>
    <svg class="power-on">
      <use xlink:href="#line" class="line" />
      <use xlink:href="#circle" class="circle" />
    </svg>
  </div>
</div>

<!-- SVG -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150" id="line">
    <line x1="75" y1="34" x2="75" y2="58"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150" id="circle">
    <circle cx="75" cy="80" r="35"/>
  </symbol>
</svg>
  
  <h2>Already Read</h2>
  <div id="container">
    <span id="loading">Fetching latest books...</span>
  </div>
  <h2>Currently Reading</h2>
  <div id="container2">
    <div id="currentlyReading">
      <span id="loadingCurrentlyReading">Fetching currently reading books...</span>
    </div>
  </div>

  <h2>Want to Read</h2>
  <div id="container3">
    <!-- Add a container for Want to Read -->
    <div id="wantToRead">
      <span id="loadingWantToRead">Fetching want to read books...</span>
    </div>
  </div>

  <script>
    !function($,r){if("object"==typeof exports){var e=r();"object"==typeof module&&module&&module.exports&&(exports=module.exports=e),exports.randomColor=e}else"function"==typeof define&&define.amd?define([],r):$.randomColor=r()}(this,function(){var $=null,r={};u("monochrome",null,[[0,0],[100,0],]),u("red",[-26,18],[[20,100],[30,92],[40,89],[50,85],[60,78],[70,70],[80,60],[90,55],[100,50],]),u("orange",[18,46],[[20,100],[30,93],[40,88],[50,86],[60,85],[70,70],[100,70],]),u("yellow",[46,62],[[25,100],[40,94],[50,89],[60,86],[70,84],[80,82],[90,80],[100,75],]),u("green",[62,178],[[30,100],[40,90],[50,85],[60,81],[70,74],[80,64],[90,50],[100,40],]),u("blue",[178,257],[[20,100],[30,86],[40,80],[50,74],[60,60],[70,52],[80,44],[90,39],[100,35],]),u("purple",[257,282],[[20,100],[30,87],[40,79],[50,70],[60,65],[70,59],[80,52],[90,45],[100,42],]),u("pink",[282,334],[[20,100],[30,90],[40,86],[60,84],[80,80],[90,75],[100,73],]);var e=[],n=function(u){if(void 0!==(u=u||{}).seed&&null!==u.seed&&u.seed===parseInt(u.seed,10))$=u.seed;else if("string"==typeof u.seed)$=function $(r){for(var e=0,n=0;n!==r.length&&!(e>=Number.MAX_SAFE_INTEGER);n++)e+=r.charCodeAt(n);return e}(u.seed);else if(void 0!==u.seed&&null!==u.seed)throw TypeError("The seed value must be an integer or string");else $=null;if(null!==u.count&&void 0!==u.count){for(var _,l,f,c=u.count,h=[],g=0;g<u.count;g++)e.push(!1);for(u.count=null;c>h.length;){var v=n(u);null!==$&&(u.seed=$),h.push(v)}return u.count=c,h}return l=function $(r,e){if("monochrome"===e.hue)return 0;if("random"===e.luminosity)return a([0,100]);var n,u=(n=r,t(n).saturationRange),o=u[0],i=u[1];switch(e.luminosity){case"bright":o=55;break;case"dark":o=i-10;break;case"light":i=55}return a([o,i])}(_=function $(n){if(e.length>0){var u,o=function $(e){if(isNaN(e)){if("string"==typeof e){if(r[e]){var n=r[e];if(n.hueRange)return n.hueRange}else if(e.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var a=i(e)[0];return t(a).hueRange}}}else{var u=parseInt(e);if(u<360&&u>0)return t(e).hueRange}return[0,360]}(n.hue),s=a(o),_=(o[1]-o[0])/e.length,l=parseInt((s-o[0])/_);return!0===e[l]?l=(l+2)%e.length:e[l]=!0,(s=a(o=[(o[0]+l*_)%359,(o[0]+(l+1)*_)%359]))<0&&(s=360+s),s}var o=function $(e){if("number"==typeof parseInt(e)){var n=parseInt(e);if(n<360&&n>0)return[n,n]}if("string"==typeof e){if(r[e]){var t=r[e];if(t.hueRange)return t.hueRange}else if(e.match(/^#?([0-9A-F]{3}|[0-9A-F]{6})$/i)){var a=i(e)[0];return[a,a]}}return[0,360]}(n.hue);return(s=a(o))<0&&(s=360+s),s}(u),u),f=function $(r,e,n){var u=function $(r,e){for(var n=t(r).lowerBounds,a=0;a<n.length-1;a++){var u=n[a][0],o=n[a][1],i=n[a+1][0],s=n[a+1][1];if(e>=u&&e<=i){var _=(s-o)/(i-u),l=o-_*u;return _*e+l}}return 0}(r,e),o=100;switch(n.luminosity){case"dark":o=u+20;break;case"light":u=(o+u)/2;break;case"random":u=0,o=100}return a([u,o])}(_,l,u),function $(r,e){switch(e.format){case"hsvArray":return r;case"hslArray":return s(r);case"hsl":var n=s(r);return"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)";case"hsla":var t=s(r),a=e.alpha||Math.random();return"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+a+")";case"rgbArray":return o(r);case"rgb":return"rgb("+o(r).join(", ")+")";case"rgba":var u=o(r),a=e.alpha||Math.random();return"rgba("+u.join(", ")+", "+a+")";default:return function $(r){var e=o(r);function n($){var r=$.toString(16);return 1==r.length?"0"+r:r}return"#"+n(e[0])+n(e[1])+n(e[2])}(r)}}([_,l,f],u)};function t($){for(var e in $>=334&&$<=360&&($-=360),r){var n=r[e];if(n.hueRange&&$>=n.hueRange[0]&&$<=n.hueRange[1])return r[e]}return"Color not found"}function a(r){if(null===$){var e=Math.random();return e+=.618033988749895,e%=1,Math.floor(r[0]+e*(r[1]+1-r[0]))}var n=r[1]||1,t=r[0]||0;return Math.floor(t+($=(9301*$+49297)%233280)/233280*(n-t))}function u($,e,n){var t=n[0][0],a=n[n.length-1][0],u=n[n.length-1][1],o=n[0][1];r[$]={hueRange:e,lowerBounds:n,saturationRange:[t,a],brightnessRange:[u,o]}}function o($){var r=$[0];0===r&&(r=1),360===r&&(r=359),r/=360;var e=$[1]/100,n=$[2]/100,t=Math.floor(6*r),a=6*r-t,u=n*(1-e),o=n*(1-a*e),i=n*(1-(1-a)*e),s=256,_=256,l=256;switch(t){case 0:s=n,_=i,l=u;break;case 1:s=o,_=n,l=u;break;case 2:s=u,_=n,l=i;break;case 3:s=u,_=o,l=n;break;case 4:s=i,_=u,l=n;break;case 5:s=n,_=u,l=o}return[Math.floor(255*s),Math.floor(255*_),Math.floor(255*l),]}function i($){var r=parseInt(($=3===($=$.replace(/^#/,"")).length?$.replace(/(.)/g,"$1$1"):$).substr(0,2),16)/255,e=parseInt($.substr(2,2),16)/255,n=parseInt($.substr(4,2),16)/255,t=Math.max(r,e,n),a=t-Math.min(r,e,n),u=t?a/t:0;switch(t){case r:return[60*((e-n)/a%6)||0,u,t];case e:return[60*((n-r)/a+2)||0,u,t];case n:return[60*((r-e)/a+4)||0,u,t]}}function s($){var r=$[0],e=$[1]/100,n=$[2]/100,t=(2-e)*n;return[r,Math.round(e*n/(t<1?t:2-t)*1e4)/100,t/2*100,]}return n});
    // Your script here
	
	"use strict";


var BugDispatch = {

    options: {
        minDelay: 500,
        maxDelay: 10000,
        minBugs: 2,
        maxBugs: 20,
        minSpeed: 5,
        maxSpeed: 10,
        maxLargeTurnDeg: 150,
        maxSmallTurnDeg: 10,
        maxWiggleDeg: 5,
        imageSprite: 'data:image/png;base64,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',
        bugWidth: 13,
        bugHeight: 14,
        num_frames: 5,
        zoom: 10, // random zoom variation from 1 to 10 - 10 being full size.
        canFly: true,
        canDie: true,
        numDeathTypes: 3,
        monitorMouseMovement: false,
        eventDistanceToBug: 40,
        minTimeBetweenMultipy: 1000,
        mouseOver: 'random' // can be 'fly', 'flyoff' (if the bug can fly), die', 'multiply', 'nothing' or 'random'
    },

    initialize: function(options) {

        this.options = mergeOptions(this.options, options);

        // sanity check:
        if (this.options.minBugs > this.options.maxBugs) {
            this.options.minBugs = this.options.maxBugs;
        }

        this.modes = ['multiply', 'nothing'];

        if (this.options.canFly) {
            this.modes.push('fly', 'flyoff');
        }
        if (this.options.canDie) {
            this.modes.push('die');
        }

        if (this.modes.indexOf(this.options.mouseOver) == -1) {
            // invalid mode: use random:
            this.options.mouseOver = 'random';
        }

        // can we transform?
        this.transform = null;

        this.transforms = {
            'Moz': function(s) {
                this.bug.style.MozTransform = s;
            },
            'webkit': function(s) {
                this.bug.style.webkitTransform = s;
            },
            'O': function(s) {
                this.bug.style.OTransform = s;
            },
            'ms': function(s) {
                this.bug.style.msTransform = s;
            },
            'Khtml': function(s) {
                this.bug.style.KhtmlTransform = s;
            },
            'w3c': function(s) {
                this.bug.style.transform = s;
            }
        };


        // check to see if it is a modern browser:

        if ('transform' in document.documentElement.style) {
            this.transform = this.transforms.w3c;
        } else {

            // feature detection for the other transforms:
            var vendors = ['Moz', 'webkit', 'O', 'ms', 'Khtml'],
                i = 0;

            for (i = 0; i < vendors.length; i++) {
                if (vendors[i] + 'Transform' in document.documentElement.style) {
                    this.transform = this.transforms[vendors[i]];
                    break;
                }
            }
        }

        // dont support transforms... quit
        if (!this.transform) return;

        // make bugs:
        this.bugs = [];
        var numBugs = (this.options.mouseOver === 'multiply') ? this.options.minBugs : this.random(this.options.minBugs, this.options.maxBugs, true),
            i = 0,
            that = this;

        for (i = 0; i < numBugs; i++) {
            var options = JSON.parse(JSON.stringify(this.options)),
                b = SpawnBug();

            options.wingsOpen = (this.options.canFly) ? ((Math.random() > 0.5) ? true : false) : true,
                options.walkSpeed = this.random(this.options.minSpeed, this.options.maxSpeed),

                b.initialize(this.transform, options);
            this.bugs.push(b);
        }

        // fly them in staggered:
        this.spawnDelay = [];
        for (i = 0; i < numBugs; i++) {
            var delay = this.random(this.options.minDelay, this.options.maxDelay, true),
                thebug = this.bugs[i];
            // fly the bug onto the page:
            this.spawnDelay[i] = setTimeout((function(thebug) {
                return function() {
                    if (that.options.canFly) {
                        thebug.flyIn();
                    } else {
                        thebug.walkIn();
                    }

                };
            }(thebug)), delay);

            // add mouse over events:
            that.add_events_to_bug(thebug);
        }

        // add window event if required:
        if (this.options.monitorMouseMovement) {
            window.onmousemove = function() {
                that.check_if_mouse_close_to_bug();
            };
        }

    },

    stop: function() {
        for (var i = 0; i < this.bugs.length; i++) {
            if(this.spawnDelay[i]) clearTimeout(this.spawnDelay[i]);
            this.bugs[i].stop();
        }
    },

    end: function() {
        for (var i = 0; i < this.bugs.length; i++) {
        	if(this.spawnDelay[i]) clearTimeout(this.spawnDelay[i]);
            this.bugs[i].stop();
            this.bugs[i].remove();
        }
    },

    reset: function() {
        this.stop();
        for (var i = 0; i < this.bugs.length; i++) {
            this.bugs[i].reset();
            this.bugs[i].walkIn();
        }
    },

    killAll: function() {
        for (var i = 0; i < this.bugs.length; i++) {
        	if(this.spawnDelay[i]) clearTimeout(this.spawnDelay[i]);
            this.bugs[i].die();
        }
    },

    add_events_to_bug: function(thebug) {
        var that = this;
        if (thebug.bug) {
            if (thebug.bug.addEventListener) {
                thebug.bug.addEventListener('mouseover', function(e) {
                    that.on_bug(thebug);
                });
            } else if (thebug.bug.attachEvent) {
                thebug.bug.attachEvent('onmouseover', function(e) {
                    that.on_bug(thebug);
                });
            }
        }
    },

    check_if_mouse_close_to_bug: function(e) {
        e = e || window.event;
        if (!e) {
            return;
        }

        var posx = 0,
            posy = 0;
        if (e.client && e.client.x) {
            posx = e.client.x;
            posy = e.client.y;
        } else if (e.clientX) {
            posx = e.clientX;
            posy = e.clientY;
        } else if (e.page && e.page.x) {
            posx = e.page.x - (document.body.scrollLeft + document.documentElement.scrollLeft);
            posy = e.page.y - (document.body.scrollTop + document.documentElement.scrollTop);
        } else if (e.pageX) {
            posx = e.pageX - (document.body.scrollLeft + document.documentElement.scrollLeft);
            posy = e.pageY - (document.body.scrollTop + document.documentElement.scrollTop);
        }
        var numBugs = this.bugs.length,
            i = 0;
        for (i = 0; i < numBugs; i++) {
            var pos = this.bugs[i].getPos();
            if (pos) {
                if (Math.abs(pos.top - posy) + Math.abs(pos.left - posx) < this.options.eventDistanceToBug && !this.bugs[i].flyperiodical) {
                    this.near_bug(this.bugs[i]);
                }
            }
        }

    },

    near_bug: function(bug) {
        this.on_bug(bug);
    },

    on_bug: function(bug) {
        if (!bug.alive) {
            return;
        }

        var mode = this.options.mouseOver;

        if (mode === 'random') {
            mode = this.modes[(this.random(0, (this.modes.length - 1), true))];
        }

        if (mode === 'fly') {
            // fly away!
            bug.stop();
            bug.flyRand();
        } else if (mode === 'nothing') {
            return;
        } else if (mode === 'flyoff') {
            // fly away and off the page
            bug.stop();
            bug.flyOff();
        } else if (mode === 'die') {
            // drop dead!
            bug.die();
        } else if (mode === 'multiply') {
            if (!this.multiplyDelay && this.bugs.length < this.options.maxBugs) {
                // spawn another: 
                // create new bug:
                var b = SpawnBug(),
                    options = JSON.parse(JSON.stringify(this.options)),
                    pos = bug.getPos(),
                    that = this;

                options.wingsOpen = (this.options.canFly) ? ((Math.random() > 0.5) ? true : false) : true;
                options.walkSpeed = this.random(this.options.minSpeed, this.options.maxSpeed);

                b.initialize(this.transform, options);
                b.drawBug(pos.top, pos.left);
                // fly them both away:
                if (options.canFly) {
                    b.flyRand();
                    bug.flyRand();
                } else {
                    b.go();
                    bug.go();
                }
                // store new bug:
                this.bugs.push(b);
                // watch out for spawning too quickly:
                this.multiplyDelay = true;
                setTimeout(function() {
                    // add event to this bug:
                    that.add_events_to_bug(b);
                    that.multiplyDelay = false;
                }, this.options.minTimeBetweenMultipy);
            }

        }
    },

    random: function(min, max, round) {
        if (min == max) return ((round) ? Math.round(min) : min);

        var result = ((min - 0.5) + (Math.random() * (max - min + 1)));
        if (result > max) {
            result = max;
        } else if (result < min) {
            result = min;
        }
        return ((round) ? Math.round(result) : result);
    }


};

var BugController = function() {
    this.initialize.apply(this, arguments);
}
BugController.prototype = BugDispatch;

var SpiderController = function() {
    var spiderOptions = {
        imageSprite: 'data:image/png;base64,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',
        bugWidth: 69,
        bugHeight: 90,
        num_frames: 7,
        canFly: false,
        canDie: true,
        numDeathTypes: 2,
        zoom: 6,
        minDelay: 200,
        maxDelay: 3000,
        minSpeed: 6,
        maxSpeed: 13,
        minBugs: 3,
        maxBugs: 10
    };
    this.options = mergeOptions(this.options, spiderOptions);
    this.initialize.apply(this, arguments);

}
SpiderController.prototype = BugDispatch;

/***************/
/**    Bug    **/
/***************/

var Bug = {

    options: {
        wingsOpen: false,
        walkSpeed: 2,
        flySpeed: 40,
        edge_resistance: 50,
        zoom: 10

    },

    initialize: function(transform, options) {

        this.options = mergeOptions(this.options, options);

        this.NEAR_TOP_EDGE = 1;
        this.NEAR_BOTTOM_EDGE = 2;
        this.NEAR_LEFT_EDGE = 4;
        this.NEAR_RIGHT_EDGE = 8;
        this.directions = {}; // 0 degrees starts on the East
        this.directions[this.NEAR_TOP_EDGE] = 270;
        this.directions[this.NEAR_BOTTOM_EDGE] = 90;
        this.directions[this.NEAR_LEFT_EDGE] = 0;
        this.directions[this.NEAR_RIGHT_EDGE] = 180;
        this.directions[this.NEAR_TOP_EDGE + this.NEAR_LEFT_EDGE] = 315;
        this.directions[this.NEAR_TOP_EDGE + this.NEAR_RIGHT_EDGE] = 225;
        this.directions[this.NEAR_BOTTOM_EDGE + this.NEAR_LEFT_EDGE] = 45;
        this.directions[this.NEAR_BOTTOM_EDGE + this.NEAR_RIGHT_EDGE] = 135;

        this.angle_deg = 0;
        this.angle_rad = 0;
        this.large_turn_angle_deg = 0;
        this.near_edge = false;
        this.edge_test_counter = 10;
        this.small_turn_counter = 0;
        this.large_turn_counter = 0;
        this.fly_counter = 0;
        this.toggle_stationary_counter = Math.random() * 50;
        this.zoom = this.random(this.options.zoom, 10) / 10;

        this.stationary = false;
        this.bug = null;
        this.active = true;
        this.wingsOpen = this.options.wingsOpen;
        this.transform = transform;
        this.walkIndex = 0;
        this.flyIndex = 0;
        this.alive = true;
        this.twitchTimer = null;

        this.rad2deg_k = 180 / Math.PI;
        this.deg2rad_k = Math.PI / 180;

        this.makeBug();

        this.angle_rad = this.deg2rad(this.angle_deg);

        this.angle_deg = this.random(0, 360, true);

    },

    go: function() {
        if (this.transform) {
            this.drawBug();
            var that = this;

            this.animating = true;

            this.going = requestAnimFrame(function(t) {
                that.animate(t);
            });
        }
    },

    stop: function() {
        this.animating = false;
        if (this.going) {
            clearTimeout(this.going);
            this.going = null;
        }
        if (this.flyperiodical) {
            clearTimeout(this.flyperiodical);
            this.flyperiodical = null;
        }
        if (this.twitchTimer) {
            clearTimeout(this.twitchTimer);
            this.twitchTimer = null;
        }
    },

    remove: function() {
    	this.active = false;
        if (this.inserted && this.bug.parentNode) {
            this.bug.parentNode.removeChild(this.bug);
            this.inserted = false;
        }
    },

    reset: function() {
        this.alive = true;
        this.active = true;
        this.bug.style.bottom = '';
        this.bug.style.top = 0;
        this.bug.style.left = 0;
        this.bug.classList.remove('bug-dead');
    },

    animate: function(t) {

        if (!this.animating || !this.alive || !this.active) return;

        var that = this;
        this.going = requestAnimFrame(function(t) {
            that.animate(t);
        });

        if (!('_lastTimestamp' in this)) this._lastTimestamp = t;

        var delta = t - this._lastTimestamp;

        if (delta < 40) return; // don't animate too frequently

        // sometimes if the browser doesnt have focus, or the delta in request animation 
        // frame can be very large. We set a sensible max so that the bugs dont spaz out.

        if (delta > 200) delta = 200;

        this._lastTimestamp = t;

        if (--this.toggle_stationary_counter <= 0) {
            this.toggleStationary();
        }
        if (this.stationary) {
            return;
        }


        if (--this.edge_test_counter <= 0 && this.bug_near_window_edge()) {
            // if near edge, go away from edge
            this.angle_deg %= 360;
            if (this.angle_deg < 0) this.angle_deg += 360;

            if (Math.abs(this.directions[this.near_edge] - this.angle_deg) > 15) {
                var angle1 = this.directions[this.near_edge] - this.angle_deg;
                var angle2 = (360 - this.angle_deg) + this.directions[this.near_edge];
                this.large_turn_angle_deg = (Math.abs(angle1) < Math.abs(angle2) ? angle1 : angle2);

                this.edge_test_counter = 10;
                this.large_turn_counter = 100;
                this.small_turn_counter = 30;
            }
        }
        if (--this.large_turn_counter <= 0) {
            this.large_turn_angle_deg = this.random(1, this.options.maxLargeTurnDeg, true);
            this.next_large_turn();
        }
        if (--this.small_turn_counter <= 0) {
            this.angle_deg += this.random(1, this.options.maxSmallTurnDeg);
            this.next_small_turn();
        } else {
            var dangle = this.random(1, this.options.maxWiggleDeg, true);
            if ((this.large_turn_angle_deg > 0 && dangle < 0) || (this.large_turn_angle_deg < 0 && dangle > 0)) {
                dangle = -dangle; // ensures both values either + or -
            }
            this.large_turn_angle_deg -= dangle;
            this.angle_deg += dangle;
        }

        this.angle_rad = this.deg2rad(this.angle_deg);

        var dx = Math.cos(this.angle_rad) * this.options.walkSpeed * (delta / 100);
        var dy = -Math.sin(this.angle_rad) * this.options.walkSpeed * (delta / 100);

        this.moveBug((this.bug.left + dx), (this.bug.top + dy), (90 - this.angle_deg));
        this.walkFrame();

    },

    makeBug: function() {
        if (!this.bug && this.active) {
            var row = (this.wingsOpen) ? '0' : '-' + this.options.bugHeight + 'px',
                bug = document.createElement('div');
            bug.className = 'bug';
            bug.style.background = 'transparent url(' + this.options.imageSprite + ') no-repeat 0 ' + row;
            bug.style.width = this.options.bugWidth + 'px';
            bug.style.height = this.options.bugHeight + 'px';
            bug.style.position = 'fixed';
            bug.style.top = 0;
            bug.style.left = 0;
            bug.style.zIndex = '50';

            this.bug = bug;
            this.setPos();

        }

    },

    setPos: function(top, left) {
        this.bug.top = top || this.random(this.options.edge_resistance, document.documentElement.clientHeight - this.options.edge_resistance);

        this.bug.left = left || this.random(this.options.edge_resistance, document.documentElement.clientWidth - this.options.edge_resistance);

        this.moveBug(this.bug.left, this.bug.top, (90 - this.angle_deg));
    },

    moveBug: function(x, y, deg) {
        // keep track of where we are:
        this.bug.left = x;
        this.bug.top = y;

        // transform:
        var trans = "translate(" + parseInt(x) + "px," + parseInt(y) + "px)";
        if (deg) {
            //console.log("translate("+(x)+"px, "+(y)+"px) rotate("+deg+"deg)");
            trans += " rotate(" + deg + "deg)";
        }
        trans += " scale(" + this.zoom + ")";

        this.transform(trans);

    },

    drawBug: function(top, left) {

        if (!this.bug) {
            this.makeBug();
        }
        if(!this.bug) return;

        if (top && left) {
            this.setPos(top, left);
        } else {
            this.setPos(this.bug.top, this.bug.left)
        }
        if (!this.inserted) {
            this.inserted = true;
            document.body.appendChild(this.bug);
        }
    },

    toggleStationary: function() {
        this.stationary = !this.stationary;
        this.next_stationary();
        var ypos = (this.wingsOpen) ? '0' : '-' + this.options.bugHeight + 'px';
        if (this.stationary) {

            this.bug.style.backgroundPosition = '0 ' + ypos;
        } else {
            this.bug.style.backgroundPosition = '-' + this.options.bugWidth + 'px ' + ypos;
        }
    },

    walkFrame: function() {
        var xpos = (-1 * (this.walkIndex * this.options.bugWidth)) + 'px',
            ypos = (this.wingsOpen) ? '0' : '-' + this.options.bugHeight + 'px';
        this.bug.style.backgroundPosition = xpos + ' ' + ypos;
        this.walkIndex++;
        if (this.walkIndex >= this.options.num_frames) this.walkIndex = 0;
    },

    fly: function(landingPosition) {
        var currentTop = this.bug.top,
            currentLeft = this.bug.left,
            diffx = (currentLeft - landingPosition.left),
            diffy = (currentTop - landingPosition.top),
            angle = Math.atan(diffy / diffx);

        if (Math.abs(diffx) + Math.abs(diffy) < 50) {
            this.bug.style.backgroundPosition = (-2 * this.options.bugWidth) + 'px -' + (2 * this.options.bugHeight) + 'px';
        }
        if (Math.abs(diffx) + Math.abs(diffy) < 30) {
            this.bug.style.backgroundPosition = (-1 * this.options.bugWidth) + 'px -' + (2 * this.options.bugHeight) + 'px';
        }
        if (Math.abs(diffx) + Math.abs(diffy) < 10) {
            // close enough:
            this.bug.style.backgroundPosition = '0 0'; //+row+'px'));

            this.stop();
            this.go();
            //this.go.delay(100, this);

            return;

        }

        // make it wiggle: disabled becuase its just too fast to see... better would be to make its path wiggly.
        //angle = angle - (this.deg2rad(this.random(0,10)));
        //console.log('angle: ',this.rad2deg(angle));

        var dx = Math.cos(angle) * this.options.flySpeed,
            dy = Math.sin(angle) * this.options.flySpeed;

        if ((currentLeft > landingPosition.left && dx > 0) || (currentLeft > landingPosition.left && dx < 0)) {
            // make sure angle is right way
            dx = -1 * dx;
            if (Math.abs(diffx) < Math.abs(dx)) {
                dx = dx / 4;
            }
        }
        if ((currentTop < landingPosition.top && dy < 0) || (currentTop > landingPosition.top && dy > 0)) {
            dy = -1 * dy;
            if (Math.abs(diffy) < Math.abs(dy)) {
                dy = dy / 4;
            }
        }

        this.moveBug((currentLeft + dx), (currentTop + dy));

    },

    flyRand: function() {
        this.stop();
        var landingPosition = {};
        landingPosition.top = this.random(this.options.edge_resistance, document.documentElement.clientHeight - this.options.edge_resistance);
        landingPosition.left = this.random(this.options.edge_resistance, document.documentElement.clientWidth - this.options.edge_resistance);

        this.startFlying(landingPosition);
    },

    startFlying: function(landingPosition) {

        var currentTop = this.bug.top,
            currentLeft = this.bug.left,
            diffx = (landingPosition.left - currentLeft),
            diffy = (landingPosition.top - currentTop);

        this.bug.left = landingPosition.left;
        this.bug.top = landingPosition.top;

        this.angle_rad = Math.atan(diffy / diffx);
        this.angle_deg = this.rad2deg(this.angle_rad);

        if (diffx > 0) {
            // going left: quadrant 1 or 2
            this.angle_deg = 90 + this.angle_deg;
        } else {
            // going right: quadrant 3 or 4
            this.angle_deg = 270 + this.angle_deg;
        }

        this.moveBug(currentLeft, currentTop, this.angle_deg);

        // start animation:
        var that = this;
        this.flyperiodical = setInterval(function() {
            that.fly(landingPosition);
        }, 10);
    },

    flyIn: function() {
        if (!this.bug) {
            this.makeBug();
        }
        
        if(!this.bug) return;

        this.stop();
        // pick a random side:
        var side = Math.round(Math.random() * 4 - 0.5),
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            windowX = window.innerWidth || e.clientWidth || g.clientWidth,
            windowY = window.innerHeight || e.clientHeight || g.clientHeight;
        if (side > 3) side = 3;
        if (side < 0) side = 0;
        var style = {},
            s;
        if (side === 0) {
            // top:
            style.top = (-2 * this.options.bugHeight);
            style.left = Math.random() * windowX;
        } else if (side === 1) {
            // right:
            style.top = Math.random() * windowY;
            style.left = windowX + (2 * this.options.bugWidth);
        } else if (side === 2) {
            // bottom:
            style.top = windowY + (2 * this.options.bugHeight);
            style.left = Math.random() * windowX;
        } else {
            // left: 
            style.top = Math.random() * windowY;
            style.left = (-3 * this.options.bugWidth);
        }
        var row = (this.wingsOpen) ? '0' : '-' + this.options.bugHeight + 'px';
        this.bug.style.backgroundPosition = (-3 * this.options.bugWidth) + 'px ' + row;
        this.bug.top = style.top
        this.bug.left = style.left

        this.drawBug();

        // landing position:
        var landingPosition = {};
        landingPosition.top = this.random(this.options.edge_resistance, document.documentElement.clientHeight - this.options.edge_resistance);
        landingPosition.left = this.random(this.options.edge_resistance, document.documentElement.clientWidth - this.options.edge_resistance);

        this.startFlying(landingPosition);
    },

    walkIn: function() {
        if (!this.bug) {
            this.makeBug();
        }
        
        if(!this.bug) return;

        this.stop();
        // pick a random side:
        var side = Math.round(Math.random() * 4 - 0.5),
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            windowX = window.innerWidth || e.clientWidth || g.clientWidth,
            windowY = window.innerHeight || e.clientHeight || g.clientHeight;
        if (side > 3) side = 3;
        if (side < 0) side = 0;
        var style = {},
            s;
        if (side === 0) {
            // top:
            style.top = (-1.3 * this.options.bugHeight);
            style.left = Math.random() * windowX;
        } else if (side === 1) {
            // right:
            style.top = Math.random() * windowY;
            style.left = windowX + (0.3 * this.options.bugWidth);
        } else if (side === 2) {
            // bottom:
            style.top = windowY + (0.3 * this.options.bugHeight);
            style.left = Math.random() * windowX;
        } else {
            // left: 
            style.top = Math.random() * windowY;
            style.left = (-1.3 * this.options.bugWidth);
        }
        var row = (this.wingsOpen) ? '0' : '-' + this.options.bugHeight + 'px';
        this.bug.style.backgroundPosition = (-3 * this.options.bugWidth) + 'px ' + row;
        this.bug.top = style.top
        this.bug.left = style.left

        this.drawBug();

        // start walking:
        this.go();

    },

    flyOff: function() {
        this.stop();
        // pick a random side to fly off to, where 0 is top and continuing clockwise.
        var side = this.random(0, 3),
            style = {},
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            windowX = window.innerWidth || e.clientWidth || g.clientWidth,
            windowY = window.innerHeight || e.clientHeight || g.clientHeight;

        if (side === 0) {
            // top:
            style.top = -200;
            style.left = Math.random() * windowX;
        } else if (side === 1) {
            // right:
            style.top = Math.random() * windowY;
            style.left = windowX + 200;
        } else if (side === 2) {
            //bottom:
            style.top = windowY + 200;
            style.left = Math.random() * windowX;
        } else {
            // left: 
            style.top = Math.random() * windowY;
            style.left = -200;
        }
        this.startFlying(style);
    },

    die: function() {
        this.stop();
        //pick death style:
        var deathType = this.random(0, this.options.numDeathTypes - 1);

        this.alive = false;
        this.drop(deathType);
    },

    drop: function(deathType) {
        var startPos = this.bug.top,
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            finalPos = window.innerHeight || e.clientHeight || g.clientHeight,
            finalPos = finalPos - this.options.bugHeight,
            rotationRate = this.random(0, 20, true),
            startTime = Date.now(),
            that = this;
        
        this.bug.classList.add('bug-dead');

        this.dropTimer = requestAnimFrame(function(t) {
            that._lastTimestamp = t;
            that.dropping(t, startPos, finalPos, rotationRate, deathType);
        });

    },

    dropping: function(t, startPos, finalPos, rotationRate, deathType) {
        var elapsedTime = t - this._lastTimestamp,
            deltaPos = (0.002 * (elapsedTime * elapsedTime)),
            newPos = startPos + deltaPos;
        //console.log(t, elapsedTime, deltaPos, newPos);

        var that = this;


        if (newPos >= finalPos) {
            newPos = finalPos;
            clearTimeout(this.dropTimer);



            this.angle_deg = 0;
            this.angle_rad = this.deg2rad(this.angle_deg);
            this.transform("rotate(" + (90 - this.angle_deg) + "deg) scale(" + this.zoom + ")");
            this.bug.style.top = null;
            // because it is (or might be) zoomed and rotated, we cannot just just bottom = 0. Figure out real bottom position:
            var rotationOffset = ((this.options.bugWidth * this.zoom) - (this.options.bugHeight * this.zoom)) / 2;
            var zoomOffset = ((this.options.bugHeight) / 2) * (1 - this.zoom);
            this.bug.style.bottom = Math.ceil((rotationOffset - zoomOffset)) + 'px'; // because its rotated and zoomed.
            this.bug.style.left = this.bug.left + 'px';
            this.bug.style.backgroundPosition = '-' + ((deathType * 2) * this.options.bugWidth) + 'px 100%';


            this.twitch(deathType);

            return;
        }

        this.dropTimer = requestAnimFrame(function(t) {
            that.dropping(t, startPos, finalPos, rotationRate, deathType);
        });

        if (elapsedTime < 20) return;

        this.angle_deg = ((this.angle_deg + rotationRate) % 360);
        this.angle_rad = this.deg2rad(this.angle_deg);

        this.moveBug(this.bug.left, newPos, this.angle_deg);
    },

    twitch: function(deathType, legPos) {
        //this.bug.style.back
        if (!legPos) legPos = 0;
        var that = this;
        if (deathType === 0 || deathType === 1) {
            that.twitchTimer = setTimeout(function() {
                that.bug.style.backgroundPosition = '-' + ((deathType * 2 + (legPos % 2)) * that.options.bugWidth) + 'px 100%';
                that.twitchTimer = setTimeout(function() {
                    legPos++;
                    that.bug.style.backgroundPosition = '-' + ((deathType * 2 + (legPos % 2)) * that.options.bugWidth) + 'px 100%';
                    that.twitch(deathType, ++legPos);
                }, that.random(300, 800));
            }, this.random(1000, 10000));
        }
    },

    /* helper methods: */
    rad2deg: function(rad) {
        return rad * this.rad2deg_k;
    },
    deg2rad: function(deg) {
        return deg * this.deg2rad_k;
    },
    random: function(min, max, plusminus) {
        if (min == max) return min;
        var result = Math.round(min - 0.5 + (Math.random() * (max - min + 1)));
        if (plusminus) return Math.random() > 0.5 ? result : -result;
        return result;
    },

    next_small_turn: function() {
        this.small_turn_counter = Math.round(Math.random() * 10);
    },
    next_large_turn: function() {
        this.large_turn_counter = Math.round(Math.random() * 40);
    },
    next_stationary: function() {
        this.toggle_stationary_counter = this.random(50, 300);
    },

    bug_near_window_edge: function() {
        this.near_edge = 0;
        if (this.bug.top < this.options.edge_resistance)
            this.near_edge |= this.NEAR_TOP_EDGE;
        else if (this.bug.top > document.documentElement.clientHeight - this.options.edge_resistance)
            this.near_edge |= this.NEAR_BOTTOM_EDGE;
        if (this.bug.left < this.options.edge_resistance)
            this.near_edge |= this.NEAR_LEFT_EDGE;
        else if (this.bug.left > document.documentElement.clientWidth - this.options.edge_resistance)
            this.near_edge |= this.NEAR_RIGHT_EDGE;
        return this.near_edge;
    },

    getPos: function() {
        if (this.inserted && this.bug && this.bug.style) {
            return {
                'top': parseInt(this.bug.top, 10),
                'left': parseInt(this.bug.left, 10)
            };
        }
        return null;
    }

};

var SpawnBug = function() {
    var newBug = {},
        prop;
    for (prop in Bug) {
        if (Bug.hasOwnProperty(prop)) {
            newBug[prop] = Bug[prop];
        }
    }
    return newBug;
};

// debated about which pattern to use to instantiate each bug...
// see http://jsperf.com/obj-vs-prototype-vs-other



/**
 * Helper methods:
 **/

var mergeOptions = function(obj1, obj2, clone) {
    if (typeof(clone) == 'undefined') {
        clone = true;
    }
    var newobj = (clone) ? cloneOf(obj1) : obj1;
    for (var key in obj2) {
        if (obj2.hasOwnProperty(key)) {
            newobj[key] = obj2[key];
        }
    }
    return newobj;
};

var cloneOf = function(obj) {
    if (obj == null || typeof(obj) != 'object')
        return obj;

    var temp = obj.constructor(); // changed

    for (var key in obj) {
        if (obj.hasOwnProperty(key)) {
            temp[key] = cloneOf(obj[key]);
        }
    }
    return temp;
}

/* Request animation frame polyfill */
/* http://paulirish.com/2011/requestanimationframe-for-smart-animating/ */
window.requestAnimFrame = (function() {
    return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame || function( /* function */ callback, /* DOMElement */ element) {
            window.setTimeout(callback, 1000 / 60);
        };
})();
	
	

  // Define a cache object
  const cache = {};
            // Function to calculate translateZ based on the number of pages
function calculateTranslateZ(width) {
  let temp = parseFloat(width);

return temp-50

}


   // Function to fetch data from the server or use the cached data
   function fetchData(url, cacheKey) {
    if (cache[cacheKey]) {
      // If data is present in the cache, return it
      return Promise.resolve(cache[cacheKey]);
    } else {
      // If data is not in the cache, fetch it from the server
      return fetch(url, { mode: 'cors' })
        .then(response => response.json())
        .then(data => {
          // Store the fetched data in the cache
          cache[cacheKey] = data;
          return data;
        });
    }
  }

  fetchData('https://openlibrary.org/people/483d8b/books/already-read.json', 'alreadyRead')
      .then(data => {
        const arr = [];

        $("#loading").remove();

        //console.log(data);

        // Function to handle display after all fetch calls are completed
        function displayBooks() {
          // sort by date
          const dataset = arr.sort(function (a, b) {
            return b.read_timestamp - a.read_timestamp;
          });

          dataset.forEach(d => {
            let color = randomColor();
            let width = calculateWidth(d.num_pages);
            let cover_width = parseFloat(width)/3;
            cover_width += "px";
            let imgLink = "https://covers.openlibrary.org/b/ISBN/"+d.isbn13+"-M.jpg";
            $("#container").append(`
  <a href="https://openlibrary.org/books/${d.ol_id}" target="_blank">
    <div class="book" id="${d.ol_id}" style="background-color: ${color}; width: ${width}">
      <div class="side spine" style="width: ${width}">
        <span class="spine-title">${d.title}</span>
        <span class="spine-author">${d.author}</span>
      </div>
      <div class="side top" style="width: ${width}"></div>
      <div class="side cover" style="background-image: url(${imgLink});width: 190px;transform: rotateY(90deg) translateZ(${calculateTranslateZ(width)}px)"></div>
    </div>
  </a>
`);
          });


          $("#container div.book").on("click", function () {
            // console.log( $( this ).attr('id') );
            let edition = $(this).attr('id');
            // window.open("https://openlibrary.org/books/"+edition, "_blank");
          });

          //console.log(dataset);
        }

        // pull out relevant data
        const fetchPromises = data.reading_log_entries.map(d => {
          let obj = {};

          obj.title = d.work.title;
          obj.read_date = d.logged_date;
          obj.ol_id = d.logged_edition.split("/")[2];
          obj.read_timestamp = new Date(d.logged_date.split(",")[0]);
          obj.book_link = d.work.key;
          obj.author = d.work.author_names[0];
          obj.author_link = d.work.author_keys[0];
          const link = "https://openlibrary.org/books/" + obj.ol_id + ".json";

          // Additional API call to get book details
          return fetch(link, { mode: 'cors' })
            .then(response => response.json())
            .then(bookData => {
              // Extract number of pages and add it to the object
              obj.num_pages = bookData.number_of_pages !== undefined ? bookData.number_of_pages : "N/A";
              obj.isbn13 = bookData.isbn_13 ? bookData.isbn_13[0] : 'Not available';  
              arr.push(obj);
            });
        });

        // Wait for all fetch calls to complete before displaying books
        Promise.all(fetchPromises)
          .then(() => {
            displayBooks();
          });
      });

      // Fetch data for Currently Reading
      fetchData('https://openlibrary.org/people/483d8b/books/currently-reading.json', 'currentlyReading')
      .then(data => {
        const arrCurrentlyReading = [];

        $("#loadingCurrentlyReading").remove();

        function displayCurrentlyReading() {
          // sort by date
          const dataset = arrCurrentlyReading.sort(function (a, b) {
            return b.read_timestamp - a.read_timestamp;
          });

          dataset.forEach(d => {
            let color = randomColor();
            let width = calculateWidth(d.num_pages);
            let cover_width = parseFloat(width)/3;
            cover_width += "px";
            let imgLink = "https://covers.openlibrary.org/b/ISBN/"+d.isbn13+"-M.jpg";
            $("#container2").append(`
  <a href="https://openlibrary.org/books/${d.ol_id}" target="_blank">
    <div class="book" id="${d.ol_id}" style="background-color: ${color}; width: ${width}">
      <div class="side spine" style="width: ${width}">
        <span class="spine-title">${d.title}</span>
        <span class="spine-author">${d.author}</span>
      </div>
      <div class="side top" style="width: ${width}"></div>
      <div class="side cover" style="background-image: url(${imgLink});width: 190px;transform: rotateY(90deg) translateZ(${calculateTranslateZ(width)}px)"></div>
    </div>
  </a>
`);

          });

          $("#container2 div.book").on("click", function () {
            // console.log( $( this ).attr('id') );
            let edition = $(this).attr('id');
            // window.open("https://openlibrary.org/books/"+edition, "_blank");
          });

          //console.log(dataset);
        }

                // pull out relevant data
                const fetchPromisesCurrentlyReading = data.reading_log_entries.map(d => {
          let obj = {};

          obj.title = d.work.title;
          obj.read_date = d.logged_date;
          obj.ol_id = d.logged_edition.split("/")[2];
          obj.read_timestamp = new Date(d.logged_date.split(",")[0]);
          obj.book_link = d.work.key;
          obj.author = d.work.author_names[0];
          obj.author_link = d.work.author_keys[0];
          const link = "https://openlibrary.org/books/" + obj.ol_id + ".json";

          // Additional API call to get book details
          return fetch(link, { mode: 'cors' })
            .then(response => response.json())
            .then(bookData => {
              // Extract number of pages and add it to the object
              obj.num_pages = bookData.number_of_pages !== undefined ? bookData.number_of_pages : "N/A";
              obj.isbn13 = bookData.isbn_13 ? bookData.isbn_13[0] : 'Not available';  
              arrCurrentlyReading.push(obj);
            });
        });

        Promise.all(fetchPromisesCurrentlyReading)
          .then(() => {
            displayCurrentlyReading();
          });
      });

    // Fetch data for Want to Read
    fetchData('https://openlibrary.org/people/483d8b/books/want-to-read.json', 'wantToRead')
      .then(data => {
        const arrWantToRead = [];

        $("#loadingWantToRead").remove();

        // Function to handle display for Want to Read
    function displayWantToRead() {
                // sort by date
                const dataset = arrWantToRead .sort(function (a, b) {
            return b.read_timestamp - a.read_timestamp;
          });

          dataset.forEach(d => {
            let color = randomColor();
            let width = calculateWidth(d.num_pages);
            let cover_width = parseFloat(width)/3;
            cover_width += "px";
            let imgLink = "https://covers.openlibrary.org/b/ISBN/"+d.isbn13+"-M.jpg";
            $("#container3").append(`
  <a href="https://openlibrary.org/books/${d.ol_id}" target="_blank">
    <div class="book" id="${d.ol_id}" style="background-color: ${color}; width: ${width}">
      <div class="side spine" style="width: ${width}">
        <span class="spine-title">${d.title}</span>
        <span class="spine-author">${d.author}</span>
      </div>
      <div class="side top" style="width: ${width}"></div>
      <div class="side cover" style="background-image: url(${imgLink});width: 190px;transform: rotateY(90deg) translateZ(${calculateTranslateZ(width)}px)"></div>
    </div>
  </a>
`);

          });

          $("#container3 div.book").on("click", function () {
            // console.log( $( this ).attr('id') );
            let edition = $(this).attr('id');
            // window.open("https://openlibrary.org/books/"+edition, "_blank");
          });

          //console.log(dataset);
    }

                   // pull out relevant data
                   const fetchPromisesWantToRead = data.reading_log_entries.map(d => {
          let obj = {};

          obj.title = d.work.title;
          obj.read_date = d.logged_date;
          obj.ol_id = d.logged_edition.split("/")[2];
          obj.read_timestamp = new Date(d.logged_date.split(",")[0]);
          obj.book_link = d.work.key;
          obj.author = d.work.author_names[0];
          obj.author_link = d.work.author_keys[0];
          const link = "https://openlibrary.org/books/" + obj.ol_id + ".json";

          // Additional API call to get book details
          return fetch(link, { mode: 'cors' })
            .then(response => response.json())
            .then(bookData => {
              // Extract number of pages and add it to the object
              obj.num_pages = bookData.number_of_pages !== undefined ? bookData.number_of_pages : "N/A";
              obj.isbn13 = bookData.isbn_13 ? bookData.isbn_13[0] : 'Not available';  
              arrWantToRead .push(obj);
            });
        });


        Promise.all(fetchPromisesWantToRead)
          .then(() => {
            displayWantToRead();
          });
      });




    // Function to calculate width based on logarithmic scale
    function calculateWidth(numPages) {
      // Define the minimum and maximum width
      const minWidth = 20;
      const maxWidth = 100;

      // Use linear scale to calculate width
      const width = minWidth + (maxWidth - minWidth) * (numPages / 1000);

      return Math.min(maxWidth, Math.max(minWidth, width)) + 'px';
    }
	
	$(document).ready(function () {
    // Get the checkbox and body elements
    var checkbox = $('.power-switch input');
	var overlay = $('.overlay');

    // Attach a click event to the checkbox
    checkbox.on('click', function () {
// Toggle the overlay visibility with fade transition
//overlay.toggle();

if (overlay.is(':visible')) {
        overlay.stop().animate({ opacity: 0 }, 2000, function() {
          overlay.css('display', 'none');
        });
      } else {
        overlay.css('display', 'block').stop().animate({ opacity: 1 }, 500);
		new BugController({'minBugs':1, 'maxBugs':2, 'mouseOver':'die'});
      }


    });
  });



  </script>

</body>

</html>
